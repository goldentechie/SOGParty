<div class="row">
  <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
    <h1 class="page-title txt-color-blueDark">
      <i class="fa fa-star"></i> 
        Binary Bets 
    </h1>
  </div>
</div>

<!-- Feeds tabs -->
<div id="betting">
  <div class="tabs-top">    
    <ul class="nav nav-tabs tabs-top">
      <li class="nav-betting-item active">
        <a data-toggle="tab" href="#browse-categories" data-bind="click: showFeeds">Browse feeds</a>
      </li>
      <li class="nav-betting-item" data-bind="click: showUserBets">
        <a data-toggle="tab" href="#my-open-bets">My bets</a>
      </li>
      <li class="nav-betting-item">
        <a data-toggle="tab" href="#faq"><span class="fa fa-fw fa-lg fa-question"></span>FAQ</a>
      </li>
    </ul>
    <div class="tab-content">
      <div class="tab-pane active" id="browse-categories">
        <div id="feed-filters" class="alert-info clearfix" style="background-color:#F4F8FD;padding:10px">
          <div class="form-group feed-categories">
            <label class="control-label"><b>Category</b></label>
            <div data-bind="foreach: categories">
              <label class="radio radio-inline">
                <input name="category" type="radio" data-bind="checked: $parent.currentCat, attr: {value: name}, valueUpdate: 'input'">
                <span data-bind="text: name"></span>
              </label>
            </div>
          </div>
        </div>

        <ul id="category-feeds" data-bind="foreach: { data: feeds, as: 'feed' }">
          <li class="clearfix feed-item"> 

            <header role="heading">
              <img data-bind="visible: feed.with_image, attr: {src: feed.image_url}" />
              <h2>
                <strong data-bind="text: feed.event"></strong>
                <span class="operator" data-bind="text: 'By '+feed.owner"></span>
                <div class="badges clearfix">
                  <div>
                    <span>Date</span><span data-bind="text: feed.date_str"></span>
                  </div> 
                  <div>
                    <span>Deadline</span><span data-bind="text: feed.deadline"></span>
                  </div>
                  <div>
                    <span>Fee</span><span data-bind="text: feed.fee"></span>
                  </div>
                </div>
              </h2>
            </header>  
            <div style="clear:both" class="clearfix">  
              <ul class="outcomes" data-bind="foreach: { data: feed.choices, as: 'outcome' }">
                <li class="clearfix">
                  <h3><span data-bind="text: outcome.text"></span></h3>
                  <div class="choices">
                    <a href="javascript:void(0);" class="btn-sm btn-labeled btn-success" data-bind="click: $parents[1].betEqual">
                      <span>Yes</span>
                    </a>
                    <a href="javascript:void(0);" class="btn-sm btn-labeled btn-danger" data-bind="click: $parents[1].betNotEqual">
                      <span>No</span>
                    </a>
                    <div class="odds">
                      (<span data-bind="text: outcome.odds.equal" class="txt-color-greenDark"></span>&nbsp;-&nbsp;
                      <span data-bind="text: outcome.odds.not_equal" class="txt-color-red"></span>)
                    </div>
                  </div>
                </li>
              </ul>  
            </div>   

          </li>
        </ul>
      </div> <!-- .tab-pane  " -->
      <div class="tab-pane" id="my-open-bets">

        <div id="feed-filters" class="alert-info clearfix" style="background-color:#F4F8FD;padding:10px">
          <div class="form-group feed-categories">
            <label class="control-label"><b>Status</b></label>
            <div>
              <label class="radio radio-inline">
                <input name="category" type="radio" data-bind="checked: currentStatus, attr: {value: 'open'}, valueUpdate: 'input'">
                <span>Open<span>
              </label>
              <label class="radio radio-inline">
                <input name="category" type="radio" data-bind="checked: currentStatus, attr: {value: 'filled'}, valueUpdate: 'input'">
                <span>Pending<span>
              </label>
              <label class="radio radio-inline">
                <input name="category" type="radio" data-bind="checked: currentStatus, attr: {value: 'resolved'}, valueUpdate: 'input'">
                <span>Resolved<span>
              </label>
            </div>
          </div>
        </div>

        <div class="jarviswidget defaultWidgetColor" id="userBets" data-widget-editbutton="false" data-widget-deletebutton="false">
          <header>
            <span class="widget-icon"> <i class="fa fa-rocket"></i> </span>
            <h3>My pending bets</h3>
            <div class="clearfix"></div>
          </header>
          <div> <!-- widget div-->
            <div class="widget-body no-padding"> <!-- widget content --> 
              <table id="userBetsTable" class="table table-striped table-hover datatable_basic">
                <thead>
                    <tr>                  
                      <th>Feed</th>
                      <th>Bet</th>
                      <th>Wager (remaining)</th>
                      <th>Counterwager (remaining)</th>
                    </tr>
                </thead>
                <tbody data-bind="foreach: { data: userBets, as: 'bet' }">
                  <tr>
                    <td class="betItem">
                      <h4>
                        <strong data-bind="text: bet.feed_name"></strong><br />
                        <span class="operator" data-bind="text: 'By '+bet.feed_owner"></span><br />
                        <div class="badges clearfix">
                          <div>
                            <span>Date</span><span data-bind="text: bet.date_str"></span>
                          </div><br /> 
                          <div>
                            <span>Deadline</span><span data-bind="text: bet.deadline_str"></span>
                          </div><br />
                          <div>
                            <span>Fee</span><span data-bind="text: bet.fee"></span>
                          </div>
                        </div>
                      </h4>
                    </td> 
                    <td class="betItem">
                      <h4>
                        <strong data-bind="text: bet.outcome"></strong>
                        <a href="javascript:void(0);" data-bind="attr: {class: bet.bet_type_class}">
                          <span data-bind="text: bet.bet_type_name"></span>
                        </a><br />
                        <span data-bind="text: 'with ' + bet.source_label"></span><br />
                        <span style="font-size:11px" data-bind="text: '(block: ' + bet.block_index + ')'"></span>
                      </h4>
                    </td>                                
                    <td data-bind="text: bet.wager_quantity + ' (' + bet.wager_remaining + ')'"></td>
                    <td data-bind="text: bet.counterwager_quantity + ' (' + bet.counterwager_remaining + ')'"></td>
                  </tr>
                </tbody>
              </table>
            </div> <!-- end widget content -->
          </div> <!-- end widget div -->
        </div> <!-- end widget -->

      </div>
   
      <div class="tab-pane" id="faq">
        <h2>How to create a Counterwallet feed?</h2>
        <p>
          <ul>
            <li>
              <h3>Step 1: prepare an online json</h3>
<pre>
{
    "owner": "JahPowerBit",
    "address": "muYJYjRZDPmTEMfyEGe34BGN8tZ6rmRZCu",
    "category": "sports",
    "type": "simple",
    "question": "Will Broncos win the Superbowl 2014 ?",
    "yes_label": "Yes",
    "no_label": "No",
    "image": "https://www.jahpowerbit.org/feeds/image-1.png",
    "website": "http://www.mysite.com/feeds/superbowl2014",
    "deadline": "2014/07/01 05:06:07 GMT"
}
</pre>

            </li>
            <li>
              <h3>Step 2: broadcast the json url</h3>
<pre>
text: json url (max 50 characters, ends by .json)
value: -1
fee_fraction: fees for you
timestamp: start of the bet
</pre>
            </li>
            <li>
              <h3>Step 2: broadcast the result</h3>
<pre>
text: result in text
value: 1 for YES, something else for NO (target_value always equal 1)
</pre>
            </li>

          </ul>
        </p>
      </div>  
    </div><!-- .tab-content -->

    
  </div><!-- .tabs-top -->
</div><!-- #betting -->


<!-- modal for bet -->
<div data-bind="showModal: shown" id="betModal" class="modal fade" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="betModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content" data-bind="with: feed">
      <form>
        <div class="modal-header">
          <button type="button" data-bind="click: $parent.hide" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">
            <img data-bind="visible: with_image, attr: {src: image_url}" />
            <b data-bind="text: event"></b> 
            <span data-bind="text: 'by '+owner"></span>
            <div class="badges clearfix">
              <div>
                <span>Date</span><span data-bind="text: date_str"></span>
              </div> 
              <div>
                <span>Deadline</span><span data-bind="text: $parent.deadlineStr"></span>
              </div>
              <div>
                <span>Fee</span><span data-bind="text: fee"></span>
              </div>
            </div>
          </h4>
          <h5>
            <span data-bind="text: $parent.selectedOutcome"></span>
          </h5>
        </div>
        <div class="modal-body no-padding">
          <div class="bet-source">
            <b>You go bet: </b> 
            <div data-bind="visible: $parent.betType == 'Equal'" class="badge bg-color-green" style="font-size:20px">
              <i class="glyphicon glyphicon-thumbs-up"></i>
              <span>Yes</span>
            </div>
            <div data-bind="visible: $parent.betType == 'NotEqual'" class="badge bg-color-red" style="font-size:20px">
              <i class="glyphicon glyphicon-thumbs-down"></i>
              <span>No</span>
            </div>
            <b>with: </b>
            <select class="form-control" style="width: 350px;vertical-align: top;margin-right: 12px;" name="source" data-bind="options: $parent.availableAddresses, optionsValue: 'address', optionsText: 'label', value: $parent.sourceAddress, select2: { minimumResultsForSearch: 10, escapeMarkup: 'direct' }"></select>
          </div><!-- .bet-source -->
          <div class="smart-form" style="padding:0 12px">

            <div class="wagers clearfix">
              <div class="fieldset"> 
                <label>Your wager: </label>
                <input type="text"  name="wager" class="number"  data-bind="value: $parent.wager, valueUpdate: 'input'" /> XCP
                <span class="invalid custom" data-bind="validationMessage: $parent.wager"></span>
                <div class="note">how much you are betting.</div> 
              </div>
              <div class="fieldset">            
                <label>Odd:</label>                 
                <input name="odd" class="number" data-bind="value: $parent.odd, valueUpdate: 'input'" type="text"/> XCP
                <span class="invalid custom" data-bind="validationMessage: $parent.odd"></span>
                <div class="note">how much do you want to win<br /> per 1 XCP.</div>                      
              </div>
              <div class="fieldset winnings">  
                <div>          
                  <label>Winnings:</label>
                  <span data-bind="text: $parent.counterwager + ' XCP'"></span>  
                </div>
                <div>              
                  <label>Fee:</label> 
                  <span data-bind="text: $parent.fee + ' XCP'"></span>  
                </div> 
                <div style="font-size:11px">              
                  <label>Matching:</label> 
                  <span data-bind="text: $parent.matchingVolume + ' XCP'"></span>  
                </div> 
                <div style="font-size:11px">              
                  <label>Open:</label> 
                  <span data-bind="text: $parent.openingVolume + ' XCP'"></span>  
                </div>                 
              </div>            
            </div>

            <div data-bind="visible: $parent.counterBets().length>0">
              <label>Open bets:</label> 
              <div id="counterbets">           
                <table width="100%" class="table table-striped table-hover datatable_basic">
                  <thead>
                    <tr>
                      <th>Odd</th>
                      <th>Volume</th>
                      <th>Cumul</th>
                      <th>Bets</th>
                    </tr>
                  </thead>
                  <tbody data-bind="foreach: { data: $parent.counterBets, as: 'counterbet' }">
                    <tr class="cb" data-bind="click: $parents[1].selectCounterbet, attr: {id: 'cb_'+counterbet.tx_index}">
                      <td style="text-align:center" data-bind="text: counterbet.ratio"/></td>
                      <td style="text-align:right;padding-right:10px !important;" data-bind="text: counterbet.counterwager"></td>
                      <td style="text-align:right;padding-right:10px !important;">
                        <b data-bind="text: counterbet.volume_str"></b>
                      </td>
                      <td style="text-align:right;padding-right:10px !important;" data-bind="text: counterbet.bet_count"></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div data-bind="visible: $parent.showAdvancedOptions">
              <div class="fieldset">           
                <label>Deadline:</label>                             
                <select class="form-control" name="deadline" style="width: 200px" data-bind="options: deadlines, optionsValue: 'timestamp', optionsText: 'text', value: $parent.deadline, select2: { minimumResultsForSearch: 10, escapeMarkup: 'direct' }"></select>
                <div class="note">when his bet will be decided.</div>                                  
              </div>
              <div class="fieldset">           
                <label>Expiration:</label>                 
                <input name="expiration" class="number" data-bind="value: $parent.expiration, valueUpdate: 'input'" type="text"/> blocks
                <span class="invalid custom" data-bind="validationMessage: $parent.expiration"></span>
                <div class="note">how many blocks a counterparty has to take the other side of the bet.</div>                                  
              </div>
            </div>
          </div><!-- .smart-form -->
        </div><!-- .modal-body -->
        <div class="modal-footer">
          <div style="float:left;">
            <input type="checkbox" name="showAdvancedOptions" value="1" data-bind="checked: $parent.showAdvancedOptions" />
            <label style="text-align:right">Show advanced options</label>             
          </div>

          <button type="button" class="btn btn-default" data-bind="click: $parent.hide">Cancel</button>
          <button type="button" data-bind="click: $parent.submitForm" class="btn btn-primary">Bet</button>
        </div>
      </form>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
